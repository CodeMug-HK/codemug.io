<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Live Vote Results - Fireworks</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(180deg, #0a0a1a 0%, #1a1a3e 50%, #0a0a1a 100%);
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
        }

        canvas {
            display: block;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .score-board {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 60px;
            z-index: 20;
        }

        .score {
            text-align: center;
            min-width: 120px;
        }

        .score-icon {
            font-size: 50px;
            display: block;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 20px currentColor);
        }

        .score-count {
            font-size: 72px;
            font-weight: 800;
            display: block;
            line-height: 1;
            text-shadow: 0 0 30px currentColor;
        }

        .score.boy .score-count {
            color: #5BA3EC;
            text-shadow:
                0 0 40px rgba(91, 163, 236, 1),
                0 0 80px rgba(91, 163, 236, 0.8),
                0 6px 12px rgba(0, 0, 0, 0.8),
                0 3px 6px rgba(0, 0, 0, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.9);
        }

        .score.girl .score-count {
            color: #FF6BB3;
            text-shadow:
                0 0 40px rgba(255, 107, 179, 1),
                0 0 80px rgba(255, 107, 179, 0.8),
                0 6px 12px rgba(0, 0, 0, 0.8),
                0 3px 6px rgba(0, 0, 0, 0.6),
                2px 2px 4px rgba(0, 0, 0, 0.9);
        }

        .score-label {
            font-size: 18px;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 5px;
        }

        .vs-text {
            font-size: 36px;
            font-weight: 800;
            color: rgba(255,255,255,0.3);
            align-self: center;
        }

        .side-label {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            font-size: 120px;
            opacity: 0.08;
            z-index: 1;
            pointer-events: none;
        }

        .side-label.boy {
            left: 8%;
        }

        .side-label.girl {
            right: 8%;
        }

        .her-image {
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 15;
            pointer-events: none;
            width: 20vw;
            opacity: 0.35;
        }
    </style>
</head>

<body>
    <img src="her.png" alt="" class="her-image">
    <canvas id="canvas"></canvas>

    <div class="overlay">
        <div class="score-board">
            <div class="score boy">
                <span class="score-icon">üë¶üèª</span>
                <span class="score-count" id="boyCount">0</span>
                <span class="score-label">Áî∑‰ªî Boy</span>
            </div>
            <div class="vs-text">VS</div>
            <div class="score girl">
                <span class="score-icon">üëßüèª</span>
                <span class="score-count" id="girlCount">0</span>
                <span class="score-label">Â•≥‰ªî Girl</span>
            </div>
        </div>

        <div class="side-label boy">üë¶üèª</div>
        <div class="side-label girl">üëßüèª</div>

    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width = window.innerWidth;
        const height = canvas.height = window.innerHeight;

        // Tracking
        let currentBoyCount = 0;
        let currentGirlCount = 0;

        // Particles arrays
        const rockets = [];
        const explosions = [];
        const trails = [];

        // Blue color variations - super diverse
        const blueColors = [
            '#5BA3EC',  // Base blue
            '#00FFFF',  // Cyan
            '#40E0D0',  // Turquoise
            '#1E90FF',  // Dodger blue
            '#00BFFF',  // Deep sky blue
            '#7B68EE',  // Medium slate blue
            '#4169E1',  // Royal blue
            '#87CEEB',  // Sky blue
            '#00CED1',  // Dark turquoise
            '#FFFFFF',  // White sparkle
            '#48D1CC',  // Medium turquoise
            '#6495ED',  // Cornflower blue
            '#00FF7F',  // Spring green
            '#7FFFD4',  // Aquamarine
            '#E0FFFF',  // Light cyan
            '#AFEEEE',  // Pale turquoise
            '#5F9EA0',  // Cadet blue
            '#B0E0E6',  // Powder blue
            '#ADD8E6',  // Light blue
            '#9370DB',  // Medium purple
            '#8A2BE2',  // Blue violet
            '#6A5ACD',  // Slate blue
            '#00FA9A',  // Medium spring green
            '#3CB371',  // Medium sea green
            '#FFD700',  // Gold sparkle
            '#F0E68C',  // Khaki (yellow)
            '#98FB98',  // Pale green
            '#90EE90',  // Light green
        ];

        // Pink color variations - super diverse
        const pinkColors = [
            '#FF6BB3',  // Base pink
            '#FF1493',  // Deep pink
            '#FF69B4',  // Hot pink
            '#FF00FF',  // Magenta
            '#DA70D6',  // Orchid
            '#EE82EE',  // Violet
            '#FF6347',  // Tomato
            '#FF7F50',  // Coral
            '#FFB6C1',  // Light pink
            '#FFFFFF',  // White sparkle
            '#DB7093',  // Pale violet red
            '#C71585',  // Medium violet red
            '#FF4500',  // Orange red
            '#FF8C00',  // Dark orange
            '#FFA500',  // Orange
            '#FFD700',  // Gold
            '#FFFF00',  // Yellow sparkle
            '#FA8072',  // Salmon
            '#E9967A',  // Dark salmon
            '#F08080',  // Light coral
            '#CD5C5C',  // Indian red
            '#DC143C',  // Crimson
            '#B22222',  // Fire brick
            '#FF0000',  // Red
            '#FFC0CB',  // Pink
            '#DDA0DD',  // Plum
            '#BA55D3',  // Medium orchid
            '#9932CC',  // Dark orchid
        ];

        // Gravity
        const gravity = 0.05;

        // Rocket class
        class Rocket {
            constructor(type) {
                const centerX = width / 2;
                if (type === 'boy') {
                    this.x = 50 + Math.random() * (centerX - 100);
                } else {
                    this.x = centerX + 50 + Math.random() * (centerX - 100);
                }
                this.y = height;
                this.type = type;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = -(8 + Math.random() * 4);
                this.targetY = 100 + Math.random() * (height * 0.4);
                this.trail = [];
                this.exploded = false;

                const colors = type === 'boy' ? blueColors : pinkColors;
                this.color = colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                if (this.exploded) return;

                // Add trail
                this.trail.push({ x: this.x, y: this.y, alpha: 1 });
                if (this.trail.length > 15) this.trail.shift();

                // Update trail alpha
                this.trail.forEach((t, i) => {
                    t.alpha = i / this.trail.length;
                });

                // Move rocket
                this.x += this.vx;
                this.y += this.vy;
                this.vy += gravity * 0.5;

                // Check if should explode
                if (this.y <= this.targetY || this.vy >= 0) {
                    this.explode();
                }
            }

            explode() {
                this.exploded = true;

                // Create explosion particles
                const particleCount = 60 + Math.floor(Math.random() * 40);
                const colors = this.type === 'boy' ? blueColors : pinkColors;

                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount + (Math.random() - 0.5) * 0.5;
                    const speed = 2 + Math.random() * 4;
                    const color = colors[Math.floor(Math.random() * colors.length)];

                    explosions.push(new Particle(
                        this.x, this.y,
                        Math.cos(angle) * speed,
                        Math.sin(angle) * speed,
                        color,
                        this.type
                    ));
                }

                // Secondary ring
                for (let i = 0; i < 20; i++) {
                    const angle = (Math.PI * 2 * i) / 20;
                    const speed = 1 + Math.random() * 2;
                    const color = colors[Math.floor(Math.random() * colors.length)];

                    explosions.push(new Particle(
                        this.x, this.y,
                        Math.cos(angle) * speed,
                        Math.sin(angle) * speed,
                        color,
                        this.type,
                        true  // Is secondary
                    ));
                }
            }

            draw() {
                if (this.exploded) return;

                // Draw trail
                this.trail.forEach((t, i) => {
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, 2 * t.alpha, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 200, 100, ${t.alpha * 0.8})`;
                    ctx.fill();
                });

                // Draw rocket head
                ctx.save();
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#fff';
                ctx.fill();
                ctx.restore();

                // Spark effect
                for (let i = 0; i < 3; i++) {
                    const sparkX = this.x + (Math.random() - 0.5) * 10;
                    const sparkY = this.y + Math.random() * 15;
                    ctx.beginPath();
                    ctx.arc(sparkX, sparkY, 1 + Math.random(), 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, ${150 + Math.random() * 100}, 50, ${0.5 + Math.random() * 0.5})`;
                    ctx.fill();
                }
            }
        }

        // Explosion particle class
        class Particle {
            constructor(x, y, vx, vy, color, type, isSecondary = false) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.color = color;
                this.type = type;
                this.isSecondary = isSecondary;
                this.alpha = 1;
                this.decay = 0.015 + Math.random() * 0.01;
                this.size = isSecondary ? 1 + Math.random() * 2 : 2 + Math.random() * 3;
                this.trail = [];
            }

            update() {
                // Add to trail
                if (!this.isSecondary && this.alpha > 0.3) {
                    this.trail.push({ x: this.x, y: this.y, alpha: this.alpha });
                    if (this.trail.length > 8) this.trail.shift();
                }

                this.x += this.vx;
                this.y += this.vy;
                this.vy += gravity;
                this.vx *= 0.99;
                this.alpha -= this.decay;

                // Sparkle effect - random brightness variation
                this.brightness = 0.8 + Math.random() * 0.2;
            }

            draw() {
                if (this.alpha <= 0) return;

                // Draw trail
                this.trail.forEach((t, i) => {
                    const trailAlpha = (i / this.trail.length) * t.alpha * 0.5;
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, this.size * 0.5, 0, Math.PI * 2);
                    ctx.fillStyle = this.hexToRgba(this.color, trailAlpha);
                    ctx.fill();
                });

                // Draw particle with glow
                ctx.save();
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.globalAlpha = this.alpha * this.brightness;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();

                // Inner bright core
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 0.5, 0, Math.PI * 2);
                ctx.fillStyle = '#fff';
                ctx.fill();
                ctx.restore();
            }

            hexToRgba(hex, alpha) {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
        }

        // Create a firework
        function createFirework(type) {
            rockets.push(new Rocket(type));
        }

        // Background stars
        const bgStars = [];
        for (let i = 0; i < 150; i++) {
            bgStars.push({
                x: Math.random() * width,
                y: Math.random() * height,
                size: 0.5 + Math.random() * 1.5,
                twinkle: Math.random() * Math.PI * 2
            });
        }

        // Animation time
        let time = 0;

        // Main render loop
        function render() {
            time += 0.016;

            // Fade effect for trails
            ctx.fillStyle = 'rgba(10, 10, 26, 0.2)';
            ctx.fillRect(0, 0, width, height);

            // Draw background stars
            bgStars.forEach(star => {
                const twinkle = 0.3 + Math.sin(time * 2 + star.twinkle) * 0.3;
                ctx.fillStyle = `rgba(255, 255, 255, ${twinkle})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw center divider
            ctx.save();
            ctx.shadowBlur = 15;
            ctx.shadowColor = 'rgba(255, 255, 255, 0.3)';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fillRect(width / 2 - 15, 0, 30, height);
            ctx.restore();

            // Update and draw rockets
            for (let i = rockets.length - 1; i >= 0; i--) {
                rockets[i].update();
                rockets[i].draw();
                if (rockets[i].exploded) {
                    rockets.splice(i, 1);
                }
            }

            // Update and draw explosion particles
            for (let i = explosions.length - 1; i >= 0; i--) {
                explosions[i].update();
                explosions[i].draw();
                if (explosions[i].alpha <= 0) {
                    explosions.splice(i, 1);
                }
            }

            requestAnimationFrame(render);
        }

        render();

        // Handle window resize
        window.addEventListener('resize', () => {
            location.reload();
        });

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD8Hb1xk3b3OblKxpoYWp7EGS3UY5Ppoxg",
            authDomain: "wedding-4c258.firebaseapp.com",
            projectId: "wedding-4c258",
            storageBucket: "wedding-4c258.firebasestorage.app",
            messagingSenderId: "135234203012",
            appId: "1:135234203012:web:a10b04f87c5ad4f31b41d1",
            measurementId: "G-T38F6H0CGX"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const votesRef = db.collection('votes').doc('genderPoll');

        // Real-time listener
        votesRef.onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                const boyVotes = data.boy || 0;
                const girlVotes = data.girl || 0;

                document.getElementById('boyCount').textContent = boyVotes;
                document.getElementById('girlCount').textContent = girlVotes;

                const newBoyVotes = boyVotes - currentBoyCount;
                const newGirlVotes = girlVotes - currentGirlCount;

                for (let i = 0; i < newBoyVotes; i++) {
                    setTimeout(() => createFirework('boy'), i * 300);
                }
                for (let i = 0; i < newGirlVotes; i++) {
                    setTimeout(() => createFirework('girl'), i * 300);
                }

                currentBoyCount = boyVotes;
                currentGirlCount = girlVotes;
            }
        });

        // Initialize with existing votes
        votesRef.get().then((doc) => {
            if (doc.exists) {
                const data = doc.data();
                const boyVotes = data.boy || 0;
                const girlVotes = data.girl || 0;

                const maxInitial = 30;
                for (let i = 0; i < Math.min(boyVotes, maxInitial); i++) {
                    setTimeout(() => createFirework('boy'), i * 200);
                }
                for (let i = 0; i < Math.min(girlVotes, maxInitial); i++) {
                    setTimeout(() => createFirework('girl'), i * 200);
                }

                currentBoyCount = boyVotes;
                currentGirlCount = girlVotes;
            }
        });

        // Listen for reveal
        let revealed = false;
        const revealRef = db.collection('votes').doc('reveal');
        revealRef.onSnapshot((doc) => {
            if (doc.exists && doc.data().revealed === true && !revealed) {
                revealed = true;
                showBoyReveal();
            }
        });

        // Boy reveal animation
        function showBoyReveal() {
            // Clear existing particles
            rockets.length = 0;
            explosions.length = 0;

            // Massive blue fireworks display
            let fireworkCount = 0;
            const launchInterval = setInterval(() => {
                // Launch 3-5 fireworks at once
                const batch = 3 + Math.floor(Math.random() * 3);
                for (let i = 0; i < batch; i++) {
                    createFirework('boy');
                }
                fireworkCount += batch;

                if (fireworkCount >= 50) {
                    clearInterval(launchInterval);
                }
            }, 200);

            // Hide girl score
            setTimeout(() => {
                document.querySelector('.score.girl').style.transition = 'all 1s ease';
                document.querySelector('.score.girl').style.opacity = '0';
                document.querySelector('.score.girl').style.transform = 'scale(0)';
                document.querySelector('.vs-text').style.transition = 'all 1s ease';
                document.querySelector('.vs-text').style.opacity = '0';
            }, 500);

            // Show reveal message
            setTimeout(() => {
                showRevealOverlay();
            }, 1500);
        }

        function showRevealOverlay() {
            const overlay = document.createElement('div');
            overlay.innerHTML = `
                <div class="reveal-overlay">
                    <div class="reveal-content">
                        <div class="reveal-emoji">üë¶üèª</div>
                        <div class="reveal-title">‰øÇÁî∑‰ªîÔºÅ</div>
                        <div class="reveal-subtitle">IT'S A BOY!</div>
                        <div class="reveal-sparkles">üéÜ üéá üíô üéá üéÜ</div>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);

            const style = document.createElement('style');
            style.textContent = `
                .reveal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 9999;
                    pointer-events: none;
                    background: rgba(0, 0, 0, 0.6);
                    animation: overlayFadeIn 1s ease forwards;
                }
                @keyframes overlayFadeIn {
                    from { opacity: 0; background: rgba(0, 0, 0, 0); }
                    to { opacity: 1; background: rgba(0, 0, 0, 0.6); }
                }
                .reveal-content {
                    text-align: center;
                    animation: revealBounce 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
                }
                @keyframes revealBounce {
                    0% { transform: scale(0) rotate(-10deg); opacity: 0; }
                    50% { transform: scale(1.2) rotate(5deg); }
                    100% { transform: scale(1) rotate(0deg); opacity: 1; }
                }
                .reveal-emoji {
                    font-size: 120px;
                    animation: emojiFloat 2s ease-in-out infinite;
                    filter: drop-shadow(0 0 30px rgba(91, 163, 236, 0.8));
                }
                @keyframes emojiFloat {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-20px); }
                }
                .reveal-title {
                    font-size: 72px;
                    font-weight: 900;
                    color: #5BA3EC;
                    text-shadow:
                        0 0 20px rgba(91, 163, 236, 0.8),
                        0 0 40px rgba(91, 163, 236, 0.6),
                        0 0 60px rgba(91, 163, 236, 0.4),
                        0 4px 0 #2E5FA3;
                    margin: 20px 0;
                    animation: titlePulse 1.5s ease-in-out infinite;
                }
                @keyframes titlePulse {
                    0%, 100% {
                        text-shadow:
                            0 0 20px rgba(91, 163, 236, 0.8),
                            0 0 40px rgba(91, 163, 236, 0.6),
                            0 0 60px rgba(91, 163, 236, 0.4),
                            0 4px 0 #2E5FA3;
                    }
                    50% {
                        text-shadow:
                            0 0 30px rgba(91, 163, 236, 1),
                            0 0 60px rgba(91, 163, 236, 0.8),
                            0 0 90px rgba(91, 163, 236, 0.6),
                            0 4px 0 #2E5FA3;
                    }
                }
                .reveal-subtitle {
                    font-size: 48px;
                    font-weight: 700;
                    color: white;
                    text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
                    letter-spacing: 8px;
                }
                .reveal-sparkles {
                    font-size: 36px;
                    margin-top: 20px;
                    animation: sparkleRotate 3s linear infinite;
                }
                @keyframes sparkleRotate {
                    0% { transform: rotate(-5deg); }
                    50% { transform: rotate(5deg); }
                    100% { transform: rotate(-5deg); }
                }
            `;
            document.head.appendChild(style);

            // Continuous blue fireworks
            setInterval(() => {
                if (rockets.length < 10) {
                    createFirework('boy');
                }
            }, 400);
        }
    </script>
</body>

</html>
